<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.21">
<title>Explanation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="./docinfo/copy-to-clipboard.css">
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="_explanation">Explanation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Creative Sound Blaster cards have an undocumented quirk where the DSP
busy bit toggles by itself at an unknown clock rate whether any
I/O is occurring with the card. On 486/Pentium hardware this quirk can be
detected with 16 I/O reads from the DSP status port where 8 will have
the busy bit set, and 8 will have the busy bit clear.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scope">Scope</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On Sound Blaster 16 cards, this DSP busy cycle is always running.</p>
</div>
<div class="paragraph">
<p>On Sound Blaster and Sound Blaster Pro cards, the DSP busy cycle is
active when DSP playback or recording is active.</p>
</div>
<div class="paragraph">
<p>Sound Blaster clones may emulate the busy cycle by toggling the busy bit
(port 22Ch) on I/O read (example: Gravis Ultrasound SBOS/MEGA-EM).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_side_effects_of_the_busy_cycle">Side effects of the busy cycle</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="Software%3Ademoscene%3ACrystal-Dream-by-Triton-(1992)">Crystal Dream by Triton</a> (1992)</p>
</div>
<div class="paragraph">
<p><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub></p>
</div>
<div class="paragraph">
<p><a href="Software%3Ademoscene%3ACrystal-Dream-by-Triton-(1992)">Crystal Dream by Triton</a> appears to
use the DSP busy cycle to detect when the DSP has finished the block of
audio. If it sees the busy cycle stop, then it issues DSP command 0x14
to start another DSP block. If the hardware does not have a busy cycle
(SB clones), then the demo effectively
<a href="Hardware%3ASound-Blaster%3ANagging-the-DSP">nags</a> the DSP to keep playing
continuously and audio playback works regardless. This unique method
allows the demo to keep audio playback going without having to detect or
worry about which IRQ the Sound Blaster is assigned to.</p>
</div>
<div class="paragraph">
<p>If the busy cycle never stops (Sound Blaster 16 case), then the demo
never issues command 0x14 and music eventually stops.</p>
</div>
<div class="sect2">
<h3 id="_direct_dac_based_playback">Direct DAC based playback</h3>
<div class="paragraph">
<p>This can affect some games or programs that use the direct DAC (DSP
command 0x10) method of playback from IRQ 0 if the game reads the DSP
status first to determine if itâ€™s safe to do so. If the DSP periodically
reports itself busy the timer interrupt will not be able to sustain the
sample rate and will play audio slowly. At one point, the quirk
<a href="https://youtu.be/9rCV4B4ylOs?t=4m50s">affected the DOSLIB sound blaster
test program</a> in a bad way.</p>
</div>
<div class="paragraph">
<p>A workaround for direct DAC playback is to read the DSP status port up
to 8 times to wait for the busy bit to clear if the card reports DSP
4.xx.</p>
</div>
</div>
</div>
</div>
</div>
<script src="./docinfo/copy-to-clipboard.js"></script>
</body>
</html>